# Odin Streamer - Candlestick Extension Configuration
# Copy this file to .env and update the values for your environment

# =============================================================================
# BASIC CONFIGURATION
# =============================================================================

# WebSocket Server Port
WS_PORT=8081

# API Base URL for stock data
API_BASE_URL=https://uatdev.indiratrade.com/companies-details

# Python Bridge Script Path
PYTHON_SCRIPT=b2c_bridge.py

# Force refresh stock data on startup (true/false)
FORCE_REFRESH=false

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# SQLite Database Paths
STOCK_DB=stocks.db
HISTORICAL_DB=historical.db

# TimescaleDB Connection String
# Format: postgres://username:password@host:port/database?sslmode=disable
TIMESCALE_URL=postgres://postgres:password@localhost:5432/odin_candles?sslmode=disable

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================

# Redis Connection URL
# Format: redis://[:password@]host:port[/database]
# Leave empty for default localhost:6379
REDIS_URL=redis://localhost:6379/0

# Redis Key Expiration (in hours)
REDIS_CANDLE_EXPIRY=168  # 7 days
REDIS_LATEST_EXPIRY=5    # 5 minutes

# =============================================================================
# HISTORICAL DATA API CONFIGURATION
# =============================================================================

# IndiraTrade Historical API Base URL
HISTORICAL_API_URL=https://trading.indiratrade.com:3000

# API Timeout (in seconds)
HISTORICAL_API_TIMEOUT=30

# Rate limiting (requests per minute)
HISTORICAL_API_RATE_LIMIT=60

# =============================================================================
# CANDLE ENGINE CONFIGURATION
# =============================================================================

# Market Hours (IST)
MARKET_OPEN_HOUR=9
MARKET_OPEN_MINUTE=15
MARKET_CLOSE_HOUR=15
MARKET_CLOSE_MINUTE=30

# Late tick tolerance (in minutes)
LATE_TICK_TOLERANCE=2

# Candle update channel buffer size
CANDLE_UPDATE_BUFFER=10000
CANDLE_CLOSE_BUFFER=10000
CANDLE_PATCH_BUFFER=10000

# =============================================================================
# WEBSOCKET CONFIGURATION
# =============================================================================

# WebSocket connection limits
WS_READ_BUFFER_SIZE=65536
WS_WRITE_BUFFER_SIZE=65536
WS_MAX_CONNECTIONS=1000

# Client buffer sizes (per client)
WS_CLIENT_BUFFER_SIZE=500000

# Heartbeat configuration
WS_HEARTBEAT_INTERVAL=30  # seconds
WS_PING_TIMEOUT=90        # seconds
WS_MAX_MISSED_PINGS=3

# =============================================================================
# LOGGING CONFIGURATION
# =============================================================================

# Log level (DEBUG, INFO, WARN, ERROR)
LOG_LEVEL=INFO

# Enable detailed candle logging
LOG_CANDLE_DETAILS=false

# Enable performance metrics logging
LOG_PERFORMANCE_METRICS=true

# Log file path (leave empty for stdout only)
LOG_FILE_PATH=

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================

# Tick processing buffer sizes
TICK_NORMALIZER_BUFFER=2000000
MARKET_DATA_BUFFER=5000000

# Database connection pool sizes
TIMESCALE_MAX_CONNECTIONS=25
TIMESCALE_MAX_IDLE_CONNECTIONS=5

# Redis connection pool size
REDIS_POOL_SIZE=10

# =============================================================================
# MONITORING & HEALTH CHECKS
# =============================================================================

# Enable health check endpoints
ENABLE_HEALTH_CHECKS=true

# Metrics collection interval (in seconds)
METRICS_INTERVAL=30

# Enable Prometheus metrics endpoint
ENABLE_PROMETHEUS=false
PROMETHEUS_PORT=9090

# =============================================================================
# SECURITY CONFIGURATION
# =============================================================================

# CORS settings
CORS_ALLOWED_ORIGINS=*
CORS_ALLOWED_METHODS=GET,POST,OPTIONS
CORS_ALLOWED_HEADERS=Content-Type,Authorization

# API rate limiting (requests per minute per IP)
API_RATE_LIMIT=1000

# Enable API authentication (true/false)
ENABLE_API_AUTH=false
API_SECRET_KEY=your-secret-key-here

# =============================================================================
# DEVELOPMENT & TESTING
# =============================================================================

# Enable development mode (more verbose logging, debug endpoints)
DEV_MODE=false

# Enable test data generation
ENABLE_TEST_DATA=false

# Test data symbols (comma-separated)
TEST_SYMBOLS=RELIANCE,TCS,INFY,HDFCBANK,ICICIBANK

# Simulate tick gaps for testing (true/false)
SIMULATE_TICK_GAPS=false

# =============================================================================
# BACKUP & MAINTENANCE
# =============================================================================

# Automatic cleanup of old data
AUTO_CLEANUP_ENABLED=true
CLEANUP_OLDER_THAN_DAYS=30

# Backup configuration
BACKUP_ENABLED=false
BACKUP_INTERVAL_HOURS=24
BACKUP_RETENTION_DAYS=7
BACKUP_PATH=./backups

# =============================================================================
# ADVANCED CONFIGURATION
# =============================================================================

# Enable experimental features
ENABLE_EXPERIMENTAL_FEATURES=false

# Custom timezone (default: Asia/Kolkata)
TIMEZONE=Asia/Kolkata

# Memory optimization settings
ENABLE_MEMORY_OPTIMIZATION=true
GC_TARGET_PERCENTAGE=100

# Profiling (for development)
ENABLE_PROFILING=false
PROFILING_PORT=6060

# =============================================================================
# INTEGRATION SETTINGS
# =============================================================================

# External webhook URLs for notifications
WEBHOOK_URL_ERRORS=
WEBHOOK_URL_ALERTS=

# Email notifications
SMTP_HOST=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
NOTIFICATION_EMAIL=

# Slack integration
SLACK_WEBHOOK_URL=
SLACK_CHANNEL=#trading-alerts

# =============================================================================
# EXAMPLE VALUES FOR DIFFERENT ENVIRONMENTS
# =============================================================================

# DEVELOPMENT ENVIRONMENT:
# TIMESCALE_URL=postgres://postgres:dev123@localhost:5432/odin_dev?sslmode=disable
# REDIS_URL=redis://localhost:6379/1
# LOG_LEVEL=DEBUG
# DEV_MODE=true

# STAGING ENVIRONMENT:
# TIMESCALE_URL=postgres://postgres:staging456@staging-db:5432/odin_staging?sslmode=require
# REDIS_URL=redis://staging-redis:6379/0
# LOG_LEVEL=INFO
# ENABLE_HEALTH_CHECKS=true

# PRODUCTION ENVIRONMENT:
# TIMESCALE_URL=postgres://odin_user:prod789@prod-db:5432/odin_production?sslmode=require
# REDIS_URL=redis://:redis_password@prod-redis:6379/0
# LOG_LEVEL=WARN
# ENABLE_PROMETHEUS=true
# AUTO_CLEANUP_ENABLED=true
